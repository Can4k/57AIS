<template>
  <div class="cont">
    <div class="display-block" v-show="isInstructionOpen">
      <div class="help-cont">
        <h2>üåà–ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—èüåà</h2>
        <p>–û—Å–Ω–æ–≤–Ω–æ–π —Å–∞–π—Ç –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –Ω–∞ <a href="https://is57.ru">is57.ru</a></p>

        <p>–ü–∞–Ω–µ–ª—å –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–≤ –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –Ω–∞ —Å–∞–π—Ç–µ <a href="https://admin.is57.ru">admin.is57.ru</a>.
        –î–ª—è –µ–≥–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –Ω—É–∂–µ–Ω –∞–¥–º–∏–Ω—Å–∫–∏–π —Ç–æ–∫–µ–Ω, –∫–æ—Ç–æ—Ä—ã–π –º—ã –±—É–¥–µ–º –º–µ–Ω—è—Ç—å –ø–æ—á—Ç–∏ –∫–∞–∂–¥—ã–π –¥–µ–Ω—å, —Å–ø—Ä–æ—Å–∏—Ç—å –µ–≥–æ –º–æ–∂–Ω–æ –≤ IT-department.
        <strong>–ü—Ä–∏ –≤—Å—Ç–∞–≤–∫–µ —Ç–æ–∫–µ–Ω–∞  –Ω–µ –∑–∞–±—É–¥—å—Ç–µ –Ω–∞–∂–∞—Ç—å –∫–Ω–æ–ø–∫—É ‚Äú–∑–∞–ø–∏—Å–∞—Ç—å‚Äù</strong>.
        </p>

        <p>–î–∞–ª–µ–µ  –∏–¥—É—Ç –Ω–µ—Å–∫–æ–ª—å–∫–æ –æ—á–µ–Ω—å –≤–∞–∂–Ω—ã—Ö –ø—É–Ω–∫—Ç–æ–≤.</p>

        <p>
          <strong>0. –ü–ï–†–ï–î –õ–Æ–ë–´–ú–ò –ò–ó–ú–ï–ù–ï–ù–ò–Ø–ú–ò –°–¢–û–ò–¢ –ù–ê–ñ–ò–ú–ê–¢–¨ –ö–ù–û–ü–ö–£ ¬´–û–ë–ù–û–í–ò–¢–¨¬ª (–≠—Ç–æ –ø–æ–º–æ–∂–µ—Ç –∏–∑–±–µ–∂–∞—Ç—å –≤–æ–∑–º–æ–∂–Ω—ã—Ö –∫–æ–ª–ª–∏–∑–∏–π)</strong>
        </p>

        <div class="text-inner">
          <strong>–ü–µ—Ä–µ–¥ –Ω–∞—á–∞–ª–æ–º:</strong>
          <p>
            1. –ü–µ—Ä–µ–¥ –Ω–∞—á–∞–ª–æ–º –æ–ª–∏–º–ø–∏–∞–¥—ã –Ω–∞–¥–æ –±—É–¥–µ—Ç –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å –∫–æ–º–∞–Ω–¥—ã —á–µ—Ä–µ–∑ –º–µ–Ω—é ‚Äú–î–æ–±–∞–≤–∏—Ç—å –∫–æ–º–∞–Ω–¥—É‚Äù. –ù–∞–∑–≤–∞–Ω–∏–µ –∫–ª–∞—Å—Å–∞ –ø–∏—Å–∞—Ç—å –≤ –Ω–∞—á–∞–ª–æ –Ω–∞–∑–≤–∞–Ω–∏—è.
            <strong>–ü—Ä–∏–º–µ—Ä: 10–ò. –ö—É–∫–∞—Ä–µ–∫—É.</strong>
            –ï—Å–ª–∏ –±—ã–ª–∞ —Å–æ–≤–µ—Ä—à–µ–Ω–∞ –æ—à–∏–±–∫–∞, —Ç–æ –∞–Ω–∞–ª–æ–≥–∏—á–Ω—ã–º –º–µ–Ω—é –µ–µ –Ω–∞–¥–æ –±—É–¥–µ—Ç —É–¥–∞–ª–∏—Ç—å
          </p>
          <p>
            2. –¢–∞–∫–∂–µ –Ω–∞–¥–æ –±—É–¥–µ—Ç –¥–æ–±–∞–≤–∏—Ç—å –∑–∞–¥–∞—á–∏ —á–µ—Ä–µ–∑ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â—É—é –ø–∞–Ω–µ–ª—å. –ù–∞–∑–≤–∞–Ω–∏–µ –ø—Ä–æ–∏–∑–≤–æ–ª—å–Ω–æ–µ, –º—ã —Ç–æ—á–Ω–æ –Ω–µ –∑–Ω–∞–ª–∏, –∫–∞–∫ –±—É–¥–µ—Ç —É—Å—Ç—Ä–æ–µ–Ω–∞ –æ–ª–∏–º–ø–∏–∞–¥–∞, –ø–æ—ç—Ç–æ–º—É –º–æ–∂–Ω–æ –Ω–∞–∑—ã–≤–∞—Ç—å –∫–∞–∫ ‚Äú1‚Äù, ‚Äú2‚Äù, ‚Äú3‚Äù‚Ä¶. –∏–ª–∏ ‚ÄúA‚Äù, ‚ÄúB‚Äù, ‚ÄúC‚Äù, ‚Ä¶, —Ç–∞–∫ –∏ ‚Äú–∫—Ä–æ–ª–∏–∫–∏‚Äù, ‚Äú–ø–æ—Ä–æ—Å—è—Ç–∞‚Äù –Ω—É –∏–ª–∏ –Ω–∞ —á—Ç–æ —Ö–≤–∞—Ç–∏—Ç –≤–æ–æ–±—Ä–∞–∂–µ–Ω–∏—è —Å–æ—Å—Ç–∞–≤–∏—Ç–µ–ª–µ–π. –ê–Ω–∞–ª–æ–≥–∏—á–Ω–æ, –∑–∞–¥–∞—á–∏ –º–æ–∂–Ω–æ —É–¥–∞–ª—è—Ç—å, –µ—Å–ª–∏ –±—ã–ª–∞ –¥–æ–ø—É—â–µ–Ω–∞ –æ–ø–µ—á–∞—Ç–∫–∞.
            <strong>–ù–∞–∑–≤–∞–Ω–∏—è –∑–∞–¥–∞—á –¥–æ 50 —Å–∏–º–≤–æ–ª–æ–≤. </strong> –ï—Å–ª–∏ –Ω–∞–¥–æ —É–≤–µ–ª–∏—á–∏—Ç—å —ç—Ç–∏ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è, —Ç–æ –ø–∏—à–∏—Ç–µ –≤ IT-department.
          </p>
        </div>

        <strong>–ü—Ä–æ–≤–µ—Ä—è—é—â–∏–º:</strong>
        <p>
          3.1 –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –º–µ–Ω—é ‚Äú–ü—Ä–∏–±–∞–≤–∏—Ç—å –±–∞–ª–ª—ã –∫–æ–º–∞–Ω–¥–µ‚Äù
          –≤—ã–±–∏—Ä–∞–µ—Ç–µ –≤–∞—à–µ –∑–¥–∞–Ω–∏–µ, –Ω–∞–∑–≤–∞–Ω–∏–µ –∫–æ–º–∞–Ω–¥—ã, –∞ —Ç–∞–∫–∂–µ –ø—Ä–µ–¥–º–µ—Ç –∏ —Å–∞–º–æ –ø—Ä–∏–Ω—è—Ç–æ–µ –∑–∞–¥–∞–Ω–∏–µ. –î–∞–ª–µ–µ –¥–æ–±–∞–≤–ª—è–µ—Ç–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –±–∞–ª–ª–æ–≤ –≤ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–∏ —Å —É–∫–∞–∑–∞–Ω–∏—è–º–∏ —Å–æ—Å—Ç–∞–≤–∏—Ç–µ–ª–µ–π. –û—à–∏–±–ª–∏—Å—å? <strong>–ú–æ–∂–Ω–æ –¥–æ–±–∞–≤–ª—è—Ç—å –æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω–æ–µ —á–∏—Å–ª–æ –±–∞–ª–ª–æ–≤.</strong>
        </p>
        <p>
          3.2 –ú—ã –Ω–∞—Å—Ç–æ—è—Ç–µ–ª—å–Ω–æ —Å–æ–≤–µ—Ç—É–µ–º –≤–∑—è—Ç—å –Ω–æ—É—Ç–±—É–∫ (–º–æ–∂–µ—Ç —à–∫–æ–ª—å–Ω—ã–π) –∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –¥–ª—è –∑–∞—á–∏—Å–ª–µ–Ω–∏—è –±–∞–ª–ª–æ–≤ —Ç–∞–±–ª–∏—Ü—É, –∫–æ—Ç–æ—Ä–∞—è —Ä–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∞ —á—É—Ç—å –Ω–∏–∂–µ. –¢–∞–∫ –±—É–¥–µ—Ç –≤ —Ä–∞–∑—ã —É–¥–æ–±–Ω–µ–µ –∏ –ø–æ–Ω—è—Ç–Ω–µ–µ. –ù–æ –º—ã –ø–æ–Ω–∏–º–∞–µ–º, —á—Ç–æ –±–æ–ª—å—à–∞—è —á–∞—Å—Ç—å –≤—Å–µ —Ä–∞–≤–Ω–æ –±—É–¥–µ—Ç –ø—Ä–∏–Ω–∏–º–∞—Ç—å —Å —Ç–µ–ª–µ—Ñ–æ–Ω–æ–≤, —Ç–∞–∫ —á—Ç–æ –æ—Ç –º–µ–Ω—é –≤—ã—à–µ –º—ã –Ω–µ –æ—Ç–∫–∞–∑–∞–ª–∏—Å—å.
          –ò–∑–º–µ–Ω–µ–Ω–∏—è –±—É–¥—É—Ç —É—á—Ç–µ–Ω—ã –≤ —Ç–∞–±–ª–∏—Ü–µ –ª–∏–¥–µ—Ä–æ–≤, –æ–Ω–∞ –±—É–¥–µ—Ç –Ω–∞ –≥–ª–∞–≤–Ω–æ–º —Å–∞–π—Ç–µ.
        </p>
        <p>
          <strong>4. –ù–µ –≤–≤–æ–¥–∏—Ç–µ –±–æ–ª—å—à–∏–µ —á–∏—Å–ª–∞ (–±–æ–ª—å—à–µ –º–∏–ª–ª–∏–æ–Ω–∞ –Ω–µ –Ω–∞–¥–æ, —Ö–æ—Ç—è –≤–∞–º –∏ –Ω–µ –Ω—É–∂–Ω–æ)</strong>
        </p>
        <p>
          <strong>5. –ù–∏ –≤ –∫–æ–µ–º —Å–ª—É—á–∞–µ –Ω–µ —Ç—Ä–æ–≥–∞—Ç—å –ª—é–±—ã–µ –¥—Ä—É–≥–∏–µ –ø–∞–Ω–µ–ª–∏ üí•</strong>
        </p>
        <p>
          <strong>6. –û–±—â–µ–µ –∑–∞–º–µ—á–∞–Ω–∏–µ: –Ω–µ —Ç—ã–∫–∞–π—Ç–µ –º–Ω–æ–≥–æ —Ä–∞–∑ –ø–æ–¥—Ä—è–¥ –Ω–∞ –∫–Ω–æ–ø–∫–∏, –ø–æ–¥–æ–∂–¥–∏—Ç–µ.</strong>
        </p>
        <h3 style="text-align: left;">–ï—Å–ª–∏ —á—Ç–æ-—Ç–æ –ø–æ—à–ª–æ –Ω–µ —Ç–∞–∫, –Ω–µ–∑–∞–º–µ–¥–ª–∏—Ç–µ–ª—å–Ω–æ –æ–±—Ä–∞—â–∞–π—Ç–µ—Å—å –∫ —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∞–º: </h3>
        <p style="display: flex; flex-direction: column">
          <a href="https://t.me/Can4k" class="kek">@Can4k - –°–∞—à–∞</a>
          <a href="https://t.me/CHUBBY_D" class="kek">@CHUBBY_D - –ò–ª—å—è</a>
          <a href="https://t.me/whotegsthatdies" class="kek">@whotegsthatdies - –î–∞–Ω—è</a>
        </p>
        <button @click="close_instruction">–ó–∞–∫—Ä—ã—Ç—å</button>
      </div>
    </div>
    <div class="help">
      <button @click="open_instruction">–ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è</button>
    </div>
    <h1 class="header">–ü–∞–Ω–µ–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è</h1>
    <div class="field">
      <b>–¢–æ–∫–µ–Ω</b>
      <div class="cont2">
        <input @focus="isTokenHidden = false" :type="isTokenHidden? 'password' : ''" v-model="token"
               placeholder="—Ç–æ–∫–µ–Ω">
      </div>
      <button id="token-btn" @click="write_token">–ó–∞–ø–∏—Å–∞—Ç—å</button>
    </div>

    <div class="field field2">
      <b>–ü—Ä–∏–±–∞–≤–∏—Ç—å –∫–æ–º–∞–Ω–¥–µ –±–∞–ª–ª—ã</b>
      <div class="cont2">
        <select v-model="update_building">
          <option value="" disabled>–≤—ã–±–µ—Ä–∏—Ç–µ –æ—Ç–¥–µ–ª–µ–Ω–∏–µ</option>
          <option v-for="build in buildings">{{ build }} –æ—Ç–¥.</option>
        </select>
        <select v-model="update_team_name">
          <option value="" disabled>–≤—ã–±–µ—Ä–∏—Ç–µ –∫–æ–º–∞–Ω–¥—É</option>
          <option v-for="i in get_building_list(+update_building[0])">{{ i.name }}</option>
        </select>
        <select v-model="update_subject">
          <option value="" disabled>–≤—ã–±–µ—Ä–∏—Ç–µ –ø—Ä–µ–¥–º–µ—Ç</option>
          <option v-for="i in subjects">
            {{ i }}
          </option>
        </select>
        <select v-model="update_task_name">
          <option value="" disabled>–≤—ã–±–µ—Ä–∏—Ç–µ –∑–∞–¥–∞–Ω–∏–µ</option>
          <option v-for="i in get_subject_list(update_subject)">
            {{ i.name }}
          </option>
        </select>
        <input v-model="update_balance" placeholder="–∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –±–∞–ª–ª–æ–≤">
        <button @click="updateResult">–ü—Ä–∏–±–∞–≤–∏—Ç—å</button>
      </div>
    </div>

    <div class="field field3">
      <b>–¢–∞–±–ª–∏—Ü–∞</b>
      <div id="autizm">–ü—Ä–∏—Å–≤–æ–µ–Ω–∏–µ –Ω–æ–≤–æ–≥–æ –∑–Ω–∞—á–µ–Ω–∏—è –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –ø–æ—Å–ª–µ –Ω–∞–∂–∞—Ç–∏—è –∫–Ω–æ–ø–∫–∏ –û–ö –æ–∫–æ–ª–æ
        —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–µ–π —è—á–µ–π–∫–∏
      </div>
      <button @click="update_stupid" style="margin-bottom: 5px">–û–±–Ω–æ–≤–∏—Ç—å —Ç–∞–±–ª–∏—Ü—É</button>
      <div class="scrolly" :class="{'loading-flex' : !this.show_table}">
        <div class="table-res">
          <strong class="loading" v-show="!show_table">
            –ó–∞–≥—Ä—É–∑–∫–∞
          </strong>
          <table v-show="show_table">
            <thead>
            <tr>
              <th><b></b></th>
              <th v-for="i in teams">{{ i.name }}</th>
            </tr>
            </thead>
            <tbody>
            <tr v-for="i in tasks.length">
              <th>{{ tasks[i - 1].name }}</th>
              <td v-for="j in teams.length">
                <div class="item-table">
                  <input type="number" v-if="this.resultsTable.length >= i && this.resultsTable[0].length >= j"
                         v-model="this.resultsTable[i - 1][j - 1]" class="item">
                  <button @click="update_element(teams[j - 1].id, tasks[i - 1].id, this.resultsTable[i - 1][j - 1])"
                          v-if="
                          this.resultsTable.length >= i && this.resultsTable[0].length >= j &&
                          (this.copyResultsTable[i - 1][j - 1] !== this.resultsTable[i - 1][j - 1])">
                    –û–ö
                  </button>
                </div>
              </td>
            </tr>
            </tbody>
          </table>
        </div>
      </div>
    </div>

    <div class="table-field">
      <div class="task-field">
        <div class="field">
          <b>–î–æ–±–∞–≤–∏—Ç—å –∫–æ–º–∞–Ω–¥—É</b>
          <div class="cont2">
            <input v-model="new_team_name" placeholder="–Ω–∞–∑–≤–∞–Ω–∏–µ">
            <select v-model="new_team_building">
              <option disabled value="">–≤—ã–±–µ—Ä–∏—Ç–µ –æ—Ç–¥–µ–ª–µ–Ω–∏–µ</option>
              <option v-for="build in buildings">{{ build }} –æ—Ç–¥.</option>
            </select>
            <button @click="add_team">–î–æ–±–∞–≤–∏—Ç—å</button>
          </div>
        </div>

        <div class="field">
          <b>–£–¥–∞–ª–∏—Ç—å –∫–æ–º–∞–Ω–¥—É</b>
          <div class="cont2">
            <select v-model="remove_team_building">
              <option disabled value="">–≤—ã–±–µ—Ä–∏—Ç–µ –æ—Ç–¥–µ–ª–µ–Ω–∏–µ</option>
              <option v-for="build in buildings">{{ build }} –æ—Ç–¥.</option>
            </select>
            <select v-model="remove_team_name">
              <option disabled value="">–≤—ã–±–µ—Ä–∏—Ç–µ –∫–æ–º–∞–Ω–¥—É</option>
              <option v-for="team in get_building_list(+this.remove_team_building[0])">{{ team.name }}</option>
            </select>
            <button @click="remove_team">–£–¥–∞–ª–∏—Ç—å</button>
          </div>
        </div>
      </div>
      <div class="task-field">
        <div class="field">
          <b>–î–æ–±–∞–≤–∏—Ç—å –∑–∞–¥–∞–Ω–∏–µ</b>
          <div class="cont2">
            <select v-model="new_task_subject">
              <option disabled value="">–≤—ã–±–µ—Ä–∏—Ç–µ –ø—Ä–µ–¥–º–µ—Ç</option>
              <option v-for="sub in subjects">{{ sub }}</option>
            </select>
            <input v-model="new_task_name" placeholder="–Ω–∞–∑–≤–∞–Ω–∏–µ">
            <button @click="add_task">–î–æ–±–∞–≤–∏—Ç—å</button>
          </div>
        </div>

        <div class="field">
          <b>–£–¥–∞–ª–∏—Ç—å –∑–∞–¥–∞–Ω–∏–µ</b>
          <div class="cont2">
            <select v-model="remove_task_subject">
              <option disabled value="">–≤—ã–±–µ—Ä–∏—Ç–µ –ø—Ä–µ–¥–º–µ—Ç</option>
              <option v-for="sub in subjects">{{ sub }}</option>
            </select>
            <select v-model="remove_task_name">
              <option disabled value="">–≤—ã–±–µ—Ä–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ</option>
              <option v-for="sub in get_subject_list(this.remove_task_subject)">{{ sub.name }}</option>
            </select>
            <button @click="remove_task">–£–¥–∞–ª–∏—Ç—å</button>
          </div>
        </div>
      </div>
    </div>

    <div class="cont3">
      <div class="field">
        <h1>–°–ø–∏—Å–æ–∫ –∫–æ–º–∞–Ω–¥</h1>
        <div v-for="i in teams" class="list">
          <b>id: </b>{{ i.id }}, <b>–æ—Ç–¥–µ–ª–µ–Ω–∏–µ: </b>{{ i.building }}, <b>–Ω–∞–∑–≤–∞–Ω–∏–µ: </b>{{ i.name }}
        </div>
      </div>

      <div class="field">
        <h1>–°–ø–∏—Å–æ–∫ –∑–∞–¥–∞–Ω–∏–π</h1>
        <div v-for="i in tasks" class="list">
          <b>id: </b>{{ i.id }}, <b>–ø—Ä–µ–¥–º–µ—Ç: </b> {{ i.subject }}, <b>–Ω–∞–∑–≤–∞–Ω–∏–µ: </b>{{ i.name }}
        </div>
      </div>
    </div>

    <div class="field" style="padding: 40px">
      <h1>–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞</h1>
      <b>–ò–∑–º–µ–Ω–∏—Ç—å –∑–Ω–∞—á–µ–Ω–∏–µ date (–Ω–µ –º–µ–Ω—è—Ç—å –±–µ–∑ –ø—Ä–µ–¥—Å—Ç–∞–≤–∏—Ç–µ–ª—è –æ—Ç —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤)</b>
      <div style="margin-top: 10px">
        <b style="font-size: 10px">–ó–∞–ø–∏—Å—ã–≤–∞—Ç—å –≤ —Ñ–æ—Ä–º–∞—Ç–µ :: October 10, 2022 10:00</b>
      </div>
      <div class="cont2">
        <input v-model="new_data_val" placeholder="–Ω–æ–≤–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ">
        <button @click="post_data">–ò–∑–º–µ–Ω–∏—Ç—å</button>
      </div>
    </div>
  </div>
</template>

<script>
export default {
  name: "panel",
  data() {
    return {
      token: "",
      teams: [],
      tasks: [],
      results: {},
      resultsTable: [[]],
      copyResultsTable: [[]],
      subjects: [
        '–±–∏–æ–ª–æ–≥–∏—è',
        '–≥–µ–æ–≥—Ä–∞—Ñ–∏—è',
        '–∏–Ω—Ñ–æ—Ä–º–∞—Ç–∏–∫–∞',
        '–∏—Å—Ç–æ—Ä–∏—è',
        '–ª–∏–Ω–≥–≤–∏—Å—Ç–∏–∫–∞',
        '–ª–∏—Ç–µ—Ä–∞—Ç—É—Ä–∞',
        '–º–∞—Ç–µ–º–∞—Ç–∏–∫–∞',
        '–º—Ö–∫',
        '—Ñ–∏–∑–∏–∫–∞',
        '—Ö–∏–º–∏—è',
        '—ç–∫–æ–Ω–æ–º–∏–∫–∞',
      ],
      buildings: [
        1, 3
      ],
      legalSymbols: [' ', '-'],

      isTokenHidden: true,

      new_data_val: "",

      new_team_name: "",
      new_team_building: "",

      remove_team_building: "",
      remove_team_name: "",

      new_task_subject: "",
      new_task_name: "",

      remove_task_subject: "",
      remove_task_name: "",

      update_building: "",
      update_team_name: "",
      update_subject: "",
      update_task_name: "",
      update_balance: "",

      show_table: false,
      isInstructionOpen: false,
    }
  },
  methods: {
    open_instruction() {
      this.isInstructionOpen = true;
      document.body.style.overflow = 'hidden';
      localStorage['passed'] = 'true';
    },

    close_instruction() {
      this.isInstructionOpen = false;
      document.body.style.overflow = 'auto';
    },

    write_token() {
      this.isTokenHidden = true;
      localStorage['token'] = this.token;
    },

    async getTeamList() {
      let res = await fetch('https://back.is57.ru/teams', {
        mode: "cors"
      });
      if (res.ok) {
        res = await res.json();
        return res;
      } else {
        return [];
      }
    },

    async getTaskList() {
      let res = await fetch('https://back.is57.ru/tasks', {
        mode: "cors"
      });
      if (res.ok) {
        res = await res.json();
        return res;
      } else {
        return [];
      }
    },

    async getResultList() {
      let res = await fetch('https://back.is57.ru/results', {
        mode: "cors"
      });
      if (res.ok) {
        res = await res.json();
        return res;
      } else {
        return [];
      }
    },

    async post_data() {
      let res = await fetch(`https://back.is57.ru/date/set?token=${this.token}&value=${this.new_data_val}`);
      if (await res.text() !== 'invalid token') {
        this.new_data_val = '';
      } else {
        alert('–ù–µ–≤–µ—Ä–Ω—ã–π —Ç–æ–∫–µ–Ω')
      }
    },

    async add_team() {
      this.new_team_name = this.new_team_name.trim();
      for (let c of this.new_team_name) {
        if (this.legalSymbols.indexOf(c) === -1) {
          alert('–ò–º—è –∫–æ–º–∞–Ω–¥—ã –º–æ–∂–µ—Ç —Å–æ–¥–µ—Ä–∂–∞—Ç—å —Ç–æ–ª—å–∫–æ –º–∞–ª–µ–Ω—å–∫–∏–µ –∏ –±–æ–ª—å—à–∏–µ –ª–∞—Ç–∏–Ω—Å–∫–∏–µ –±—É–∫–≤—ã, –±—É–∫–≤—ã –∫–∏—Ä–∏–ª–ª–∏—Ü—ã, –∞ —Ç–∞–∫–∂–µ —Ü–∏—Ñ—Ä—ã, —Ç–∏—Ä–µ –∏ –ø—Ä–æ–±–µ–ª.')
          return;
        }
      }
      if (!this.token || !this.new_team_name || !this.new_team_building) {
        alert('–í—ã –Ω–µ –≤—ã–±—Ä–∞–ª–∏ –æ—Ç–¥–µ–ª–µ–Ω–∏–µ, –∏–ª–∏ –Ω–µ –≤–≤–µ–ª–∏ —Ç–æ–∫–µ–Ω, –∏–ª–∏ –Ω–µ –≤–≤–µ–ª–∏ –Ω–∞–∑–≤–∞–Ω–∏–µ')
        return;
      }
      let building = this.new_team_building[0];
      let name = this.new_team_name;
      this.new_team_name = "";
      this.new_team_building = "";
      let check_res = await this.getTeamList();
      for (let i of check_res) {
        if (i.name === name) {
          alert('–ù–µ –º–æ–∂–µ—Ç –±—ã—Ç—å –¥–≤—É—Ö –∫–æ–º–∞–Ω–¥ —Å –æ–¥–∏–Ω–∞–∫–æ–≤—ã–º –Ω–∞–∑–≤–∞–Ω–∏–µ–º')
          return;
        }
      }
      let res = await fetch(`https://back.is57.ru/teams/add?building=${building}&name=${name}&token=${this.token}`);
      if (await res.text() !== 'invalid token') {
        this.new_team_name = "";
        this.new_team_building = "";
      } else {
        alert('–ù–µ–≤–µ—Ä–Ω—ã–π —Ç–æ–∫–µ–Ω')
        return;
      }
      this.teams = await this.getTeamList();
      this.teams.sort((b, a) => {
        return a.building > b.building ? -1 : a.building === b.building ? 0 : 1;
      })
      this.tasks.sort((a, b) => {
        return a.subject < b.subject ? -1 : a.subject === b.subject ? 0 : 1;
      });
      this.results = await this.getResultList();
      this.rebuild(this.results);
    },

    get_building_list(val) {
      let res = [];
      if (!val) {
        res = this.teams;
      } else {
        for (let i of this.teams) {
          if (i.building === val) {
            res.push(i);
          }
        }
      }
      return res;
    },

    get_subject_list(val) {
      let res = [];
      if (!val) {
        res = this.tasks;
      } else {
        for (let i of this.tasks) {
          if (i.subject === val) {
            res.push(i);
          }
        }
      }
      return res;
    },

    async remove_team() {
      if (!this.token || !this.remove_team_name || !this.remove_team_building) {
        alert('–í—ã –Ω–µ –≤–≤–µ–ª–∏ —Ç–æ–∫–µ–Ω –∏–ª–∏ –Ω–µ –≤–≤–µ–ª–∏ –Ω–∞–∑–≤–∞–Ω–∏–µ')
        return;
      }
      let id = -1;
      for (let i of this.teams) {
        if (i.building === +this.remove_team_building[0] && i.name === this.remove_team_name) {
          id = i.id;
          break;
        }
      }
      if (id === -1) {
        return;
      }
      this.remove_team_building = "";
      this.remove_team_name = "";
      let res = await fetch(`https://back.is57.ru/teams/del?token=${this.token}&id=${id}`);
      if (await res.text() !== 'invalid token') {
        this.remove_team_name = "";
        this.remove_team_building = "";
      } else {
        alert('–ù–µ–≤–µ—Ä–Ω—ã–π —Ç–æ–∫–µ–Ω')
        return;
      }
      this.teams = await this.getTeamList();
      this.teams.sort((b, a) => {
        return a.building > b.building ? -1 : a.building === b.building ? 0 : 1;
      })
      this.tasks.sort((a, b) => {
        return a.subject < b.subject ? -1 : a.subject === b.subject ? 0 : 1;
      })
      this.results = await this.getResultList();
      this.rebuild(this.results);
    },

    async add_task() {
      this.new_task_name = this.new_task_name.trim();
      for (let c of this.new_task_name) {
        if (this.legalSymbols.indexOf(c) === -1) {
          alert('–ò–º—è –∫–æ–º–∞–Ω–¥—ã –º–æ–∂–µ—Ç —Å–æ–¥–µ—Ä–∂–∞—Ç—å —Ç–æ–ª—å–∫–æ –º–∞–ª–µ–Ω—å–∫–∏–µ –∏ –±–æ–ª—å—à–∏–µ –ª–∞—Ç–∏–Ω—Å–∫–∏–µ –±—É–∫–≤—ã, –±—É–∫–≤—ã –∫–∏—Ä–∏–ª–ª–∏—Ü—ã, –∞ —Ç–∞–∫–∂–µ —Ü–∏—Ñ—Ä—ã, —Ç–∏—Ä–µ –∏ –ø—Ä–æ–±–µ–ª.')
          return;
        }
      }
      if (!this.token || !this.new_task_subject || !this.new_task_name) {
        alert('–í—ã –Ω–µ –≤—ã–±—Ä–∞–ª–∏ –ø—Ä–µ–¥–º–µ—Ç, –∏–ª–∏ –Ω–µ –≤–≤–µ–ª–∏ —Ç–æ–∫–µ–Ω, –∏–ª–∏ –Ω–µ –≤–≤–µ–ª–∏ –Ω–∞–∑–≤–∞–Ω–∏–µ');
        return;
      }
      for (let i of this.tasks) {
        if (i.name === this.new_task_name) {
          alert('–ù–µ –º–æ–∂–µ—Ç –±—ã—Ç—å –¥–≤—É—Ö –æ–¥–∏–Ω–∞–∫–æ–≤—ã—Ö –ø–æ –Ω–∞–∑–≤–∞–Ω–∏—é –∑–∞–¥–∞–Ω–∏–π')
          return;
        }
      }
      let task_sub = this.new_task_subject;
      let task_name = this.new_task_name;
      this.new_task_name = "";
      this.new_task_subject = "";
      let res = await fetch(`https://back.is57.ru/tasks/add?subject=${task_sub}&name=${task_name}&token=${this.token}`);
      if (await res.text() !== 'invalid token') {
        this.new_task_name = "";
        this.new_task_subject = "";
      } else {
        alert('–ù–µ–≤–µ—Ä–Ω—ã–π —Ç–æ–∫–µ–Ω')
        return;
      }
      this.tasks = await this.getTaskList();
      this.teams.sort((b, a) => {
        return a.building > b.building ? -1 : a.building === b.building ? 0 : 1;
      })
      this.tasks.sort((a, b) => {
        return a.subject < b.subject ? -1 : a.subject === b.subject ? 0 : 1;
      })
      this.results = await this.getResultList();
      this.rebuild(this.results);
    },

    async remove_task() {
      if (!this.token || !this.remove_task_name || !this.remove_task_subject) {
        alert('–í—ã –Ω–µ –≤–≤–µ–ª–∏ —Ç–æ–∫–µ–Ω –∏–ª–∏ –Ω–µ –≤–≤–µ–ª–∏ –Ω–∞–∑–≤–∞–Ω–∏–µ');
        return;
      }
      let id = -1;
      for (let i of this.tasks) {
        if (i.name === this.remove_task_name && i.subject === this.remove_task_subject) {
          id = i.id;
          break;
        }
      }
      let res = await fetch(`https://back.is57.ru/tasks/del?id=${id}&token=${this.token}`);
      if (await res.text() !== 'invalid token') {
        this.remove_task_name = "";
        this.remove_task_subject = "";
      } else {
        alert('–ù–µ–≤–µ—Ä–Ω—ã–π —Ç–æ–∫–µ–Ω')
        return;
      }
      this.tasks = await this.getTaskList();
      this.teams.sort((b, a) => {
        return a.building > b.building ? -1 : a.building === b.building ? 0 : 1;
      })
      this.tasks.sort((a, b) => {
        return a.subject < b.subject ? -1 : a.subject === b.subject ? 0 : 1;
      })
      this.results = await this.getResultList();
      this.rebuild(this.results);
    },

    async get_smart_result(team_id, task_id) {
      let total = await fetch('https://back.is57.ru/results');
      if (!total.ok) {
        return 0;
      }
      total = await total.json();
      for (let i of total[team_id].results) {
        if (i.taskInfo.id === task_id) {
          return i.result;
        }
      }
      return 0;
    },

    get_team_id(building, name) {
      for (let i of this.teams) {
        if (i.name === name && i.building === +building[0]) {
          return i.id;
        }
      }
    },

    get_task_id(subject, name) {
      for (let i of this.tasks) {
        if (i.name === name && i.subject === subject) {
          return i.id;
        }
      }
    },

    async updateResult() {
      if (!this.token || !this.update_balance || !this.update_team_name || !this.update_task_name || !this.update_subject || !this.update_building) {
        alert('–í—ã —á—Ç–æ-—Ç–æ –∑–∞–±—ã–ª–∏ —É–∫–∞–∑–∞—Ç—å (–≤–æ–∑–º–æ–∂–Ω–æ —Ç–æ–∫–µ–Ω)');
        return;
      }
      let team_id = this.get_team_id(this.update_building, this.update_team_name);
      let task_id = this.get_task_id(this.update_subject, this.update_task_name);
      if (!team_id || !task_id) {
        alert('–ß—Ç–æ-—Ç–æ –Ω–µ —Ç–∞–∫');
        return;
      }
      let val = +this.update_balance;
      this.update_balance = "";
      this.update_team_name = "";
      this.update_task_name = "";
      val += await this.get_smart_result(team_id, task_id);
      let res = await fetch(`https://back.is57.ru/results/set?token=${this.token}&team_id=${team_id}&task_id=${task_id}&value=${val}`);
      this.results = await this.getResultList();
      this.rebuild(this.results);
      if (await res.text() !== 'invalid token') {
      } else {
        alert('–ù–µ–≤–µ—Ä–Ω—ã–π —Ç–æ–∫–µ–Ω')
      }
    },

    async update_stupid() {
      this.show_table = false;
      this.results = await this.getResultList().then((e) => {
        let width = this.teams.length;
        let height = this.tasks.length;
        this.resultsTable = new Array(height);
        this.copyResultsTable = new Array(height);
        for (let i = 0; i < height; i++) {
          this.resultsTable[i] = new Array(width);
          this.copyResultsTable[i] = new Array(width);
          for (let j = 0; j < width; j++) {
            this.resultsTable[i][j] = '';
            this.copyResultsTable[i][j] = '';
          }
        }
        let arr = {};
        for (let i = 0; i < this.tasks.length; i++) {
          arr[this.tasks[i].id] = i;
        }
        for (let i = 0; i < this.teams.length; i++) {
          if (!e[this.teams[i].id]) {
            continue;
          }
          for (let j of e[this.teams[i].id].results) {
            let dlt = j.result === 0? '' : j.result;
            this.resultsTable[arr[j.taskInfo.id]][i] = dlt;
            this.copyResultsTable[arr[j.taskInfo.id]][i] = dlt;
          }
        }
        this.show_table = true;
      });
    },

    async update_element(team_id, task_id, val) {
      if (!val) {
        val = 0;
      }
      let flag = false;
      let res = await fetch(`https://back.is57.ru/results/set?token=${this.token}&team_id=${team_id}&task_id=${task_id}&value=${val}`);
      if (await res.text() === 'invalid token') {
        alert('–ù–µ–≤–µ—Ä–Ω—ã–π —Ç–æ–∫–µ–Ω');
        flag = true;
      }
      let team_ind = -1, task_ind = -1;
      for (let i = 0; i < this.teams.length; i++) {
        if (this.teams[i].id === team_id) {
          team_ind = i;
          break;
        }
      }
      for (let i = 0; i < this.tasks.length; i++) {
        if (this.tasks[i].id === task_id) {
          task_ind = i;
          break;
        }
      }
      if (!flag) {
        this.resultsTable[task_ind][team_ind] = val;
        this.copyResultsTable[task_ind][team_ind] = val;
      }
      this.results = await this.getResultList().then((e) => {
        this.rebuild(e);
      })
    },
    rebuild(e) {
      let width = this.teams.length;
      let height = this.tasks.length;
      this.resultsTable = new Array(height);
      this.copyResultsTable = new Array(height);
      for (let i = 0; i < height; i++) {
        this.resultsTable[i] = new Array(width);
        this.copyResultsTable[i] = new Array(width);
        for (let j = 0; j < width; j++) {
          this.resultsTable[i][j] = '';
          this.copyResultsTable[i][j] = '';
        }
      }
      let arr = {};
      for (let i = 0; i < this.tasks.length; i++) {
        arr[this.tasks[i].id] = i;
      }
      for (let i = 0; i < this.teams.length; i++) {
        if (!e[this.teams[i].id]) {
          continue;
        }
        for (let j of e[this.teams[i].id].results) {
          let dlt = j.result === 0? '' : j.result;
          this.resultsTable[arr[j.taskInfo.id]][i] = dlt;
          this.copyResultsTable[arr[j.taskInfo.id]][i] = dlt;
        }
      }
    },
  },

  async mounted() {
    if (!localStorage.getItem('passed')) {
      this.open_instruction();
    }

    for (let i = 'a'.charCodeAt(0); i <= 'z'.charCodeAt(0); i++) {
      this.legalSymbols.push(String.fromCharCode(i));
    }
    for (let i = 'A'.charCodeAt(0); i <= 'Z'.charCodeAt(0); i++) {
      this.legalSymbols.push(String.fromCharCode(i));
    }
    for (let i = '0'.charCodeAt(0); i <= '9'.charCodeAt(0); i++) {
      this.legalSymbols.push(String.fromCharCode(i));
    }
    for (let i = '–∞'.charCodeAt(0); i <= '—è'.charCodeAt(0); i++) {
      this.legalSymbols.push(String.fromCharCode(i));
    }
    for (let i = '–ê'.charCodeAt(0); i <= '–Ø'.charCodeAt(0); i++) {
      this.legalSymbols.push(String.fromCharCode(i));
    }

    if (localStorage['token']) {
      this.token = localStorage['token'];
    }
    this.teams = await this.getTeamList();
    this.tasks = await this.getTaskList();
    this.results = await this.getResultList().then((e) => {
      this.teams.sort((b, a) => {
        return a.building > b.building ? -1 : a.building === b.building ? 0 : 1;
      })
      this.tasks.sort((a, b) => {
        return a.subject < b.subject ? -1 : a.subject === b.subject ? 0 : 1;
      })
      this.rebuild(e);
      this.show_table = true;
    });
  },
}
</script>

<style scoped>
.cont2 * {
  margin-left: 5px;
  margin-right: 5px;
  margin-bottom: 5px;
}

.cont {
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
}

.field {
  padding: 10px;
  background: #efefef;
  border-radius: 10px;
  margin: 15px;
}

h1 {
  margin: 10px;
}

input {
  border-radius: 5px;
  border: none;
  padding: 4px;
}

button {
  padding: 4px;
  border-radius: 5px;
  border: 1px solid lightgrey;
  cursor: pointer;
}

.cont2 {
  margin-top: 10px;
  display: flex;
  justify-content: center;
  align-items: center;
  flex-wrap: wrap;
}

.list {
  margin: 10px;
}

.select {
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  margin: 2px;
  flex-wrap: wrap;
}

.select strong {
  font-size: 12px;
  margin-bottom: 5px;
}

.task-field {
  display: flex;
  flex-direction: column;
}

.table-field {
  display: flex;
  flex-wrap: wrap;
  align-items: center;
  justify-content: center;
}

.field2 {
  padding: 10px;
  padding-top: 30px;
  background: #efefef;
  border-radius: 10px;
  margin: 30px;
  max-width: 70%
}

.field2 .cont2 {
  margin-top: 15px;
}

.field2 b {
  font-size: 30px;
}

.field2 select {
  font-size: 15px;
  padding: 2px;
}

.field2 input {
  font-size: 15px;
  padding: 6px;
}

.field2 button {
  font-size: 15px;
}

.field2 .cont2 * {
  margin-bottom: 10px;
}

.cont3 {
  display: flex;
  flex-wrap: wrap;
  margin-top: 70px;
  margin-bottom: 70px;
  text-align: left;
  justify-content: center;
}

.cont3 h1 {
  margin-bottom: 20px;
}

.header {
  font-size: 60px;
  margin: 30px;
}

#vuetable {
  font-size: 20px;
}

.table-res {
  background-color: white;
  font-size: 10px;
}

.table-res::-webkit-scrollbar {
  background-color: white;
  color: #2c3e50;
  width: 5px;
  height: 5px;
}

.table-res::-webkit-scrollbar-track {
  background-color: white;
  color: #2c3e50;
}

.table-res::-webkit-scrollbar-thumb {
  background-color: black;
}

tr {
  height: 20px;
}

th {
  width: 70px !important;
  height: 40px;
}

.item {
  width: 50px;
  margin: 5px;
}

input {
  text-align: center;
  outline: 1px solid black;
}

input[type="number"]::-webkit-outer-spin-button,
input[type="number"]::-webkit-inner-spin-button {
  -webkit-appearance: none;
}

input[type='number'],
input[type="number"]:hover,
input[type="number"]:focus {
  appearance: none;
  -moz-appearance: textfield;
}

#autizm {
  margin-top: 10px;
  margin-bottom: 10px;
  font-weight: 1000;
  font-size: 10px;
}

.field3 {
  width: 60%;
  height: 520px;
}

.scrolly {
  overflow: scroll;
  height: 400px;
  width: 100%;
  background-color: white;
}

.field3 b {
  font-size: 30px;
}

.loading-flex {
  display: flex;
  align-items: center;
  justify-content: center;
  flex-direction: column;
  font-size: 20px;
  color: rgba(44, 62, 80, 0.25);
}

.loading-flex strong {
  font-size: 30px;
}

@media screen and (max-width: 600px) {
  .field3 {
    width: 80%;
    height: 380px;
  }

  .scrolly {
    height: 250px;
  }
}

.help {
  position: fixed;
  left: 10px;
  top: 10px;
}


.display-block {
  position: fixed;
  left: 0;
  top: 0;
  z-index: 57;
  width: 100%;
  height: 100%;
  background-color: rgba(44, 62, 80, 0.24);
}

.help-cont {
  position: fixed;
  background-color: white;
  left: 50%;
  top: 50%;
  width: 500px;
  max-width: 90%;
  height: 700px;
  max-height: 75%;
  transform: translate(-50%, -50%);
  overflow-y: scroll;
  padding: 10px;
  border-radius: 10px;
}

.help-cont p {
  margin-top: 10px;
  margin-bottom: 10px;
  text-align: left;
}

.kek {
  margin-top: 3px;
  margin-bottom: 3px;
  font-size: 15px;
}

</style>